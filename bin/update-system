#! /bin/bash

if [ -z "$1" ]; then
    REMOTE=no
    EXTRAS=yes
    EXTRA_ARGS="--purge"
else
    REMOTE=yes
    EXTRAS=no
    EXTRA_ARGS="--purge"
fi

CMD="sudo apt update --list-cleanup ; "
CMD="$CMD sudo apt install $EXTRA_PACKAGES $EXTRA_ARGS && "
CMD="$CMD sudo apt dist-upgrade $EXTRA_ARGS && "
CMD="$CMD sudo apt dist-upgrade $EXTRA_ARGS && "

if [ "$EXTRAS" = "yes" ]; then
    #CMD="$CMD sudo flatpak uninstall --unused && "
    CMD="$CMD sudo flatpak update && "
fi

CMD="$CMD sudo apt install -f $EXTRA_ARGS && "
CMD="$CMD sudo apt autoremove $EXTRA_ARGS && "
CMD="$CMD sudo dpkg --configure -a && "
CMD="$CMD sudo apt clean "

if [ "$REMOTE" = "yes" ]; then
    echo "* Updating $1"
    set -x
    ssh -t $1 "$CMD"
    set +x
else
    echo "* Updating local"
    set -x
    eval $CMD
    set +x
fi
