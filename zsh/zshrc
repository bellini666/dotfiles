if [ -f "$HOME/.dotfiles/core.sh" ]; then
  source "$HOME/.dotfiles/core.sh"
fi

# History
HIST_STAMPS="yyyy-mm-dd"
SAVEHIST=50000
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_FIND_NO_DUPS

# Completion optimization
zstyle ':completion:*' use-cache on
zstyle ':completion:*' cache-path "${XDG_CACHE_HOME:-$HOME/.cache}/zsh/zcompcache"

if [ -f "/opt/homebrew/opt/antidote/share/antidote/antidote.zsh" ]; then
  antidote_dir=/opt/homebrew/opt/antidote/share/antidote
  source ${antidote_dir}/antidote.zsh
elif [ -f "/usr/share/zsh-antidote/antidote.zsh" ]; then
  antidote_dir=/usr/share/zsh-antidote
  source ${antidote_dir}/antidote.zsh
else
  antidote_dir=""
  echo "Antidote not found"
fi

if [[ "${antidote_dir}" != "" ]]; then
  zsh_plugins=${HOME}/.zsh_plugins

  [[ -f ${zsh_plugins}.txt ]] || touch ${zsh_plugins}.txt

  fpath=(${antidote_dir}/functions $fpath)
  autoload -Uz antidote

  zstyle ':antidote:bundle' use-friendly-names on

  # Generate a new static file whenever .zsh_plugins.txt is updated.
  if [[ ! ${zsh_plugins}.zsh -nt ${zsh_plugins}.txt ]]; then
    antidote bundle <${zsh_plugins}.txt >|${zsh_plugins}.zsh
  fi

  source ${zsh_plugins}.zsh
fi

if command -v mise &>/dev/null; then
  eval "$(mise activate zsh)"
fi

if command -v fzf &>/dev/null; then
  source <(fzf --zsh)
fi

if command -v starship &>/dev/null; then
  eval "$(starship init zsh)"
fi
